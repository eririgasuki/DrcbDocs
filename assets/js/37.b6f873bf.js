(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{321:function(t,s,a){t.exports=a.p+"assets/img/TakeUKey.c93dbe04.png"},322:function(t,s,a){t.exports=a.p+"assets/img/TakeUKeyAway.1d424e90.png"},396:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h2",{attrs:{id:"takeukey-发u盾页面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#takeukey-发u盾页面","aria-hidden":"true"}},[t._v("#")]),t._v(" TakeUKey 发U盾页面")]),t._v(" "),n("h3",{attrs:{id:"简易流程图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简易流程图","aria-hidden":"true"}},[t._v("#")]),t._v(" 简易流程图")]),t._v(" "),n("p",[n("img",{attrs:{src:a(321),alt:"TakeUKey"}})]),t._v(" "),n("h3",{attrs:{id:"注意点-可能的扩展改造"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意点-可能的扩展改造","aria-hidden":"true"}},[t._v("#")]),t._v(" 注意点&可能的扩展改造")]),t._v(" "),n("p",[t._v("发放UKEY的时候，需要传入发KEY箱箱号。文档和大部分厂商都是0号发放箱，1号回收箱。但实际也存在1号发放箱，2号回收箱的厂商。")]),t._v(" "),n("p",[t._v("所以获取箱号时一定要根据类型 Type （1-发放;2-回收）来判断。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" UKeyDispenser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCardUnitInfoAsync")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" unitNo "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CardUnit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Number\n")])])]),n("p",[t._v("无论最终交易结果是发放还是回收UKEY，在UKEY从KEY箱移动到卡道中时，就需要更新UKEY数量。\n调用U008接口，UKEY数量减一。（曾因C端P端都调用数量减一导致数据异常，P端已取消调用）")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" UKeyDispenser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispenseCardAsync")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Present"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Number"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" unitNo\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" RequestHelper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendAsync")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("U008")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("读取到的UKEY码实际不是文档中写的String,实际是Number，而且带了一个ASCII的空格"),n("code",[t._v("\\u0000")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" UKeyReader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readAsync")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("submitAsync")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("USBKEY_NO")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("trim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//"4838000001817\\u0000"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("这个ASCII的空格在页面中展示时一般不会出现问题，但在生成PDF电子凭证时会无法解析导致异常，所以会提前处理"),n("code",[t._v("slice(0, -1)")]),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"takeukeyaway-收发u盾页面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#takeukeyaway-收发u盾页面","aria-hidden":"true"}},[t._v("#")]),t._v(" TakeUKeyAway  收发U盾页面")]),t._v(" "),n("h3",{attrs:{id:"简易流程图-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简易流程图-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 简易流程图")]),t._v(" "),n("p",[n("img",{attrs:{src:a(322),alt:"TakeUKeyAway"}})]),t._v(" "),n("p",[t._v("和上面类似，也要先找到回收箱"),n("code",[t._v("CardUnit.find(e => e.Type === 1).Number")]),t._v("箱号才能进行回收。")]),t._v(" "),n("p",[t._v("东信厂商的UKEY设备模块由于设计问题，在用空盒子（重量较轻）测试时，经常容易卡主或掉落导致故障。尽量少用东信机具测UKEY。")]),t._v(" "),n("p",[t._v("在报错OCCUPIED时，通常是因为设备中有UKEY卡主或掉落在某处。需要手动拿出，或用外设工具调用Reset（Eject）取出。")])])}],e=a(1),r=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);s.default=r.exports}}]);